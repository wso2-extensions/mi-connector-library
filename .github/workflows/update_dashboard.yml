name: Update Connector Dashboard

on:
  workflow_dispatch:
#  schedule:
#    # Run everyday at 8:30 AM and 8:30 PM UTC
#    - cron: '30 8,20 * * *'

jobs:
  update_dashboard:
    name: Update the MI Connector Dashboard
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.WSO2_INTEGRATION_BOT_TOKEN }}

      - name: Set up Ballerina
        uses: ballerina-platform/setup-ballerina@v1.1.3
        with:
          version: 2201.10.0

      - name: Configure Git User
        run: |
          git config --global user.name ${{ secrets.WSO2_INTEGRATION_BOT_USERNAME }}
          git config --global user.email ${{ secrets.WSO2_INTEGRATION_BOT_EMAIL }}

      - name: Update the Dashboard
        run: |
          cd dashboard
          bal run
        env:
          GITHUB_TOKEN: ${{ secrets.WSO2_INTEGRATION_BOT_TOKEN }}

      - name: Commit and Push
        run: |
          git add -u
          if git diff-index --quiet HEAD --;
          then
              echo "No changes to commit"
          else
              git commit -m "[AUTOMATED] Update the connector dashboard"
              git push origin ${{ github.ref_name }}
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.WSO2_INTEGRATION_BOT_TOKEN }}
